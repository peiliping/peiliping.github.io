<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>websocket « Pei LiPing's Blog</title>
  <meta name="description" content="最近一个多月在和websocket打交道，这次来总结一下最近一阶段的工作吧。">

  <link rel="stylesheet" href="/blog/css/main.css">
  <link rel="canonical" href="http://peiliping.github.io/blog/archivers/2020-06-29-websocket">
  <link rel="alternate" type="application/rss+xml" title="Pei LiPing's Blog" href="http://peiliping.github.io/blog/feed.xml" />
</head>


  <body>

    <header class="header">
  <div class="wrapper">
    <a class="site-title" href="/blog/">Pei LiPing's Blog</a>
    <nav class="site-nav">
      
        
      
        
        <a class="page-link" href="/blog/about/">About</a>
        
      
        
        <a class="page-link" href="/blog/category/">Category</a>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </nav>
  </div>
</header>

    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">websocket</h1>
    <p class="post-meta">Jun 29, 2020</p>
  </header>

  <article class="post-content">
    <p>最近一个多月在和websocket打交道，这次来总结一下最近一阶段的工作吧。</p>

<h2 id="hydra">hydra</h2>

<p>三月份写了一篇关于netty的blog，介绍了我写的一个小项目叫<a href="https://github.com/peiliping/hydra">hydra</a>。</p>

<p>经过这几个月的完善，已经可以作为一个websocket的压测工具了。</p>

<p>这两次压测实践中，单实例可以施压5W个并发连接数，满足大多数测试需求。</p>

<p>通过参数可以配置心跳消息、订阅指令等，满足业务测试的需求。</p>

<h2 id="watchdog">watchdog</h2>

<p>使用netty作为websocket的client，如果解决重连重试的问题呢？</p>

<p>在实际业务中，要考虑网络不稳定导致的websocket中断问题。websocket中断后，</p>

<p>要重新建立连接，还要将业务的订阅指令重新发送一遍。</p>

<p>在netty的中断分为两种情况，一个是创建连接就直接失败了，一种是在运行中突然中断。</p>

<p>这两种情况分别有回调的接口可以捕获，而后触发延迟重连。可以参考<a href="https://github.com/peiliping/watchdog">watchdog</a>的实现。</p>

<h2 id="bark">Bark</h2>

<p>最近无意间发现了一个iOS的App叫Bark，可以自定义手机通知提醒的消息。</p>

<p>举个例子，你写了一个爬虫监控实时获取某只股票的价格，当他发生剧烈波动的时候，</p>

<p>给自己的手机发送一条提醒，来提醒自己关注股票。那么如何给手机发送免费的消息呢？</p>

<p>Bark就可以满足这个需求，安装Bark的App后，你会获得一个Url（包含一个uuid）。</p>

<p>执行这个Url，你的手机就会收到来自Bark的通知消息了，消息的内容来自Url参数。</p>

<h2 id="section">提醒助手</h2>

<p>将watchdog和Bark结合在一起，实现了一个小功能。</p>

<p>订阅Huobi的BTC行情信息，经过计算，将满足剧烈波动条件的消息通过Bark发送到手机上。</p>

  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="//www.gravatar.com/avatar/your_email_md5?d=mm&s=135" alt="Pei LiPing">
  <div class="col-box-title name">Pei LiPing</div>
  <p>The Cabin Of Pei LiPing.</p>
  <p class="contact">
    
    
    
    <a href="mailto:peilipingplp@gmail.com">Email</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">Newest Posts</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/blog/archivers/2021-04-27-UniswapOracle">UniswapOracle</a></li>
    
      <li><a class="post-link" href="/blog/archivers/2021-03-16-chainlink">Chainlink</a></li>
    
      <li><a class="post-link" href="/blog/archivers/2021-02-22-contract">ETH合约</a></li>
    
      <li><a class="post-link" href="/blog/archivers/2021-01-19-master">Master选举</a></li>
    
      <li><a class="post-link" href="/blog/archivers/2020-12-30-summary">2020年总结</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">TOC</div>
</div>
        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2016 Pei LiPing
</div>
</footer>

<script src="//upcdn.b0.upaiyun.com/libs/jquery/jquery-1.9.0.min.js"></script>
<script src="/blog/js/easybook.js"></script>

  </body>

</html>
